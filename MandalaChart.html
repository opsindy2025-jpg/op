<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>2025 曼陀羅計畫</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{--bg:#faf8f5;--card:#fffdf9;--text:#5d5d5d;--accent:#b8a89f;--shadow:rgba(180,160,140,0.18);}
  body.dark{--bg:#1a1a1a;--card:#252525;--text:#e8e8e8;--accent:#d8c9c0;--shadow:rgba(0,0,0,0.5);}
  body{margin:0;padding:20px 20px 120px;background:var(--bg);color:var(--text);
       font-family:"Noto Sans TC",sans-serif;transition:all .4s;}
  h1{text-align:center;color:var(--accent);margin:40px 0;font-size:2.4em;}
  .toolbar{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
           background:var(--card);padding:12px 20px;border-radius:50px;
           box-shadow:0 10px 30px var(--shadow);z-index:999;display:flex;gap:12px;}
  .btn{padding:10px 18px;background:var(--accent);color:#fff;border:none;
       border-radius:30px;cursor:pointer;font-size:14px;}
  .btn:hover{filter:brightness(1.15);}
  .add-btn{display:block;margin:50px auto;padding:16px 44px;background:var(--accent);
           color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:1.2em;font-weight:600;}
  .mandala-set{position:relative;max-width:1100px;margin:80px auto;background:var(--card);
               padding:45px;border-radius:28px;box-shadow:0 20px 50px var(--shadow);}
  .delete-btn{position:absolute;top:12px;right:12px;width:38px;height:38px;
              background:#e85d75;color:#fff;border:none;border-radius:50%;
              font-size:22px;cursor:pointer;opacity:0.8;}
  .delete-btn:hover{opacity:1;transform:scale(1.15);}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;margin-top:30px;}
  .cell{background:var(--card);border-radius:22px;padding:28px;min-height:180px;
        position:relative;box-shadow:0 6px 22px var(--shadow);transition:all .3s;}
  .cell:hover{transform:translateY(-10px);}
  .label{position:absolute;top:-999px;font-size:0;}
  .center{
    background:linear-gradient(135deg,#f5e8e1,#e8f0f5);color:#8b7a6e;
    display:flex;align-items:center;justify-content:center;text-align:center;
    font-size:1.7em;line-height:1.4;font-weight:600;
  }
  .dark .center{background:linear-gradient(135deg,#3a2f2f,#2f3a4a);color:#f0d8c0;}
  .single-content{
    margin-top:18px;font-size:1.05em;line-height:1.9;min-height:120px;
    padding:14px;background:rgba(184,168,159,0.09);border-radius:14px;
  }
  .dark .single-content{background:rgba(216,201,192,0.14);}
  [contenteditable]:focus{outline:2px solid var(--accent);}
</style>
</head>
<body>

<h1>2025 曼陀羅計畫</h1>
<button class="add-btn" onclick="addNewMandala()">＋ 新增一組曼陀羅</button>

<!-- 預設範例：2025 模板被動收入 500 萬（一定會顯示） -->
<div class="mandala-set">
  <button class="delete-btn">×</button>
  <input type="text" value="2025 模板被動收入 500 萬" style="width:100%;text-align:center;font-size:1.9em;border:none;background:transparent;color:var(--accent);font-weight:600;">
  <input type="text" value="躺著也能財富自由" style="width:100%;text-align:center;font-size:1.3em;border:none;background:transparent;color:#a89b92;margin-bottom:20px;">

  <div class="grid">
    <div class="cell" data-label="H"><div class="label">H</div><div contenteditable>里程碑與生活平衡</div><div class="single-content" contenteditable>Q1 月收 20 萬 → Q2 50 萬 → Q3 80 萬 → Q4 穩定 100 萬+
每天只工作 4-5 小時 ⋅ 每週 3 天完全離線 ⋅ 每季出國一個月</div></div>

    <div class="cell" data-label="B"><div class="label">B</div><div contenteditable>產品線規劃</div><div class="single-content" contenteditable>• Next.js 企業官網模板
• Framer 高轉換 Landing Page
• SaaS 完整網站模板
• Notion 人生系統模板
• 3D 沉浸式作品集等 8+ 條產品線</div></div>

    <div class="cell" data-label="C"><div class="label">C</div><div contenteditable>銷售平台與通路</div><div class="single-content" contenteditable>Gumroad（主戰場）+ Lemon Squeezy + 自架網站 + Envato + 小紅書 + 微信視頻號 + 聯盟行銷 30-50% 分成</div></div>

    <div class="cell" data-label="G"><div class="label">G</div><div contenteditable>自動化與團隊外包</div><div class="single-content" contenteditable>ChatGPT 客服自動化 ⋅ 影片剪輯外包 ⋅ 設計外包（菲律賓/印尼）⋅ Notion+Make 自動化 ⋅ 年底招 1 位全職助手</div></div>

    <div class="cell center" data-label="A"><div class="label">A</div>
      <div contenteditable style="font-size:1.8em;line-height:1.4;">2025 年<br>純模板被動收入<br>500 萬</div>
    </div>

    <div class="cell" data-label="D"><div class="label">D</div><div contenteditable>價格與收入結構</div><div class="single-content" contenteditable>高階 $199-$499 ⋅ 中階 $79-$149 ⋅ Notion $29-$79 ⋅ 訂閱 $39/月 ⋅ 終身會員 $999 ⋅ 企業授權 $1999-$4999 ⋅ 聯盟分潤 80-100 萬</div></div>

    <div class="cell" data-label="I"><div class="label">I</div><div contenteditable>內容行銷引擎</div><div class="single-content" contenteditable>每週 1 支 YouTube ⋅ 每天 2-3 則 X ⋅ 每月 1 個免費模板換 Email ⋅ 建 5 萬人名單 ⋅ 50 篇 SEO 文 ⋅ 每月直播教學</div></div>

    <div class="cell" data-label="E"><div class="label">E</div><div contenteditable>產品開發流程與速度</div><div class="single-content" contenteditable>每月 2 個付費模板 ⋅ V0+Cursor+Claude 極速產出 ⋅ ≤7 天一支 ⋅ 附教學影片+Figma+Notion 手冊 ⋅ 90 天退款+終身更新</div></div>

    <div class="cell" data-label="F"><div class="label">F</div><div contenteditable>備用／未來擴展</div><div class="single-content" contenteditable>開設模板訂閱學校 ⋅ 推出英文版 ⋅ 進軍 Gumroad Top 100 ⋅ 更多瘋狂想法…</div></div>
  </div>
</div>

<div class="toolbar">
  <button class="btn" onclick="toggleDark()">深色模式</button>
  <button class="btn" onclick="saveAll()">儲存</button>
  <button class="btn" onclick="exportPNG()">匯出 PNG</button>
  <button class="btn" onclick="exportExcel()">匯出 Excel</button>
</div>

<script>
// ==================== 只在「沒有儲存過資料」時才自動載入預設範例 ====================
function loadSavedOrDefault() {
  const saved = localStorage.getItem('mandalaData');
  if (saved && saved.includes('mandala-set')) {
    if (confirm('偵測到上次儲存的計畫，是否載入？（否的話會保留預設範例）')) {
      document.documentElement.innerHTML = saved;
      rebindEvents();
    }
  }
}
window.onload = () => {
  loadSavedOrDefault();
  rebindEvents(); // 確保預設那組的刪除鍵也綁定
  if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark');
};

// ==================== 其餘功能（全部正常）===================
function saveAll(){
  localStorage.setItem('mandalaData', document.documentElement.outerHTML);
  alert('已儲存！');
}

function toggleDark(){
  document.body.classList.toggle('dark');
  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
}

async function exportPNG(){
  const sets = document.querySelectorAll('.mandala-set');
  for(let i=0; i<sets.length; i++){
    const canvas = await html2canvas(sets[i], {scale:2, backgroundColor:null});
    const link = document.createElement('a');
    link.download = (sets[i].querySelector('input')?.value || '曼陀羅'+(i+1))+'.png';
    link.href = canvas.toDataURL();
    link.click();
    await new Promise(r=>setTimeout(r,300));
  }
  alert('全部 PNG 已匯出完成！');
}

function exportExcel(){
  const wb = XLSX.utils.book_new();
  document.querySelectorAll('.mandala-set').forEach((set,i)=>{
    const title = set.querySelector('input')?.value || '曼陀羅'+(i+1);
    const data = [['位置','標題','內容']];
    set.querySelectorAll('.cell').forEach(cell=>{
      const label = cell.dataset.label || '';
      if(!label) return;
      const main = cell.querySelector('[contenteditable]:not(.single-content)')?.innerText || '';
      const content = cell.querySelector('.single-content')?.innerText || '';
      data.push([label, main, content]);
    });
    const ws = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, title.slice(0,31));
  });
  XLSX.writeFile(wb, '曼陀羅計畫表_'+new Date().toISOString().slice(0,10)+'.xlsx');
  alert('Excel 已匯出完成！');
}

function rebindEvents(){
  document.querySelectorAll('.delete-btn').forEach(btn=>{
    btn.onclick = function(){
      if(confirm('確定要刪除這組曼陀羅嗎？')){
        this.parentElement.remove();
        saveAll();
      }
    };
  });
}

function addNewMandala(){
  const blank = `...（跟之前一樣的空白模板）...`;  // 省略不變
  document.querySelector('.add-btn').insertAdjacentHTML('beforebegin', blank);
  rebindEvents();
  saveAll();
  document.querySelectorAll('.mandala-set')[document.querySelectorAll('.mandala-set').length-1]
    .scrollIntoView({behavior:"smooth"});
}

function addNewMandala(){
  const blank = `
  <div class="mandala-set">
    <button class="delete-btn">×</button>
    <input type="text" value="我的新目標" style="width:100%;text-align:center;font-size:1.9em;border:none;background:transparent;color:var(--accent);font-weight:600;">
    <input type="text" value="" placeholder="副標題（可留空）" style="width:100%;text-align:center;font-size:1.2em;border:none;background:transparent;color:#a89b92;margin-bottom:20px;">
    <div class="grid">
      <div class="cell" data-label="H"><div class="label">H</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="B"><div class="label">B</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="C"><div class="label">C</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="G"><div class="label">G</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell center" data-label="A"><div class="label">A</div><div contenteditable style="font-size:1.8em;line-height:1.4;">2025 核心目標</div></div>
      <div class="cell" data-label="D"><div class="label">D</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="I"><div class="label">I</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="E"><div class="label">E</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
      <div class="cell" data-label="F"><div class="label">F</div><div contenteditable>請填入標題</div><div class="single-content" contenteditable>請在這裡輸入詳細內容…</div></div>
    </div>
  </div>`;
  document.querySelector('.add-btn').insertAdjacentHTML('beforebegin', blank);
  rebindEvents();
  saveAll();
  document.querySelectorAll('.mandala-set')[document.querySelectorAll('.mandala-set').length-1]
    .scrollIntoView({behavior:"smooth"});
}

</script>
</body>
</html>